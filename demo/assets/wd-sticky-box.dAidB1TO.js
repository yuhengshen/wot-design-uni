import{d as t,r as e,a0 as o,x as s,e as i,f as a,w as n,g as l,A as d,z as u,n as r,k as c,D as h,ae as p,V as f}from"./index-ddWhPHnE.js";import{w as b}from"./wd-resize.DLUYo0pC.js";import{b as v,m as y,D as m,a as w,o as g,p as x,g as k,_ as $}from"./wd-icon.CdzlT4Xd.js";import{u as _}from"./wd-cell.DKtYKzk0.js";import{u as C}from"./useChildren.8_evwfA-.js";const S={...v,zIndex:y(1),offsetTop:y(0)},z=Symbol("wd-sticky-box"),T=$(t({name:"wd-sticky",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:S,setup(t,{expose:f}){const v=t,y=e(`wd-sticky${m()}`),$=e([]),C=o({position:"absolute",boxLeaved:!1,top:0,height:0,width:0,state:""}),{parent:S}=_(z),{proxy:T}=h(),I=s((()=>{const t={"z-index":v.zIndex,height:w(C.height),width:w(C.width)};return C.boxLeaved||(t.position="relative"),`${g(t)};${v.customStyle}`})),L=s((()=>{const t={"z-index":v.zIndex,height:w(C.height),width:w(C.width)};return C.boxLeaved||(t.position="relative"),`${g(t)};`})),R=s((()=>{const t={position:C.position,top:w(C.top)};return g(t)})),j=s((()=>{let t=0;return t=44,44+v.offsetTop}));async function N(t){C.width=t.width,C.height=t.height,await x(),function(){if(0===C.height&&0===C.width)return;const t=j.value+C.height;(function(){for(;0!==$.value.length;)$.value.pop().disconnect()})(),function(){const t=p(T,{thresholds:[0,.5]});return $.value.push(t),t}().relativeToViewport({top:-t}).observe(`#${y.value}`,(t=>{P(t)})),k(`#${y.value}`,!1,T).then((e=>{e.bottom=Number(e.bottom)+44,Number(e.bottom)<=t&&P({boundingClientRect:e})}))}(),S&&S.observerForChild&&S.observerForChild(T)}function P({boundingClientRect:t}){if(S&&C.height>=S.boxStyle.height)return C.position="absolute",void(C.top=0);let e=t.top<=j.value;e=t.top<j.value,e?(C.state="sticky",C.boxLeaved=!1,C.position="fixed",C.top=j.value):(C.state="normal",C.boxLeaved=!1,C.position="absolute",C.top=0)}return f({setPosition:function(t,e,o){C.boxLeaved=t,C.position=e,C.top=o},stickyState:C,offsetTop:v.offsetTop}),(t,e)=>{const o=c;return i(),a(o,{style:d(`${I.value};display: inline-block;`)},{default:n((()=>[l(o,{class:r(`wd-sticky ${t.customClass}`),style:d(L.value),id:y.value},{default:n((()=>[l(o,{class:"wd-sticky__container",style:d(R.value)},{default:n((()=>[l(b,{onResize:N,"custom-style":"display: inline-block;"},{default:n((()=>[u(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["style"])])),_:3},8,["class","style","id"])])),_:3},8,["style"])}}}),[["__scopeId","data-v-ae9278a2"]]),I=$(t({name:"wd-sticky-box",options:{addGlobalClass:!0,styleIsolation:"shared"},props:v,setup(t){const s=t,v=e(`wd-sticky-box${m()}`),y=e(new Map),w=o({height:0,width:0}),{proxy:g}=h(),{children:x,linkChildren:$}=C(z);function _(t){w.width=t.width,w.height=t.height;const e=y.value;y.value=new Map;for(const[o]of e){S(x.find((t=>t.$.uid===o)))}e.forEach((t=>{t.disconnect()})),e.clear()}function S(t){!function(t){const e=y.value.get(t.$.uid);e&&(e.disconnect(),y.value.delete(t.$.uid))}(t);const e=function(t){const e=p(g,{thresholds:[0,.5]});return y.value.set(t.$.uid,e),e}(t),o=t.$.exposed;let s=o.stickyState.height+o.offsetTop;s+=44,w.height<=o.stickyState.height&&o.setPosition(!1,"absolute",0),e.relativeToViewport({top:-s}).observe(`#${v.value}`,(t=>{T(o,t)})),k(`#${v.value}`,!1,g).then((t=>{t.bottom=Number(t.bottom)+44,Number(t.bottom)<=s&&T(o,{boundingClientRect:t})})).catch((t=>{console.log(t)}))}function T(t,{boundingClientRect:e}){let o=t.offsetTop;o+=44;const s=t.stickyState.height+o;let i=e.bottom<=s;if(i=e.bottom<s,i)t.setPosition(!0,"absolute",e.height-t.stickyState.height);else if(e.top<=s&&!i){if("normal"===t.stickyState.state)return;t.setPosition(!1,"fixed",o)}}return $({boxStyle:w,observerForChild:S}),f((()=>{y.value=new Map})),(t,e)=>{const o=c;return i(),a(o,{style:{position:"relative"}},{default:n((()=>[l(o,{class:r(`wd-sticky-box ${s.customClass}`),style:d(t.customStyle),id:v.value},{default:n((()=>[l(b,{onResize:_},{default:n((()=>[u(t.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class","style","id"])])),_:3})}}}),[["__scopeId","data-v-0a2cb98b"]]);export{I as a,T as w};
