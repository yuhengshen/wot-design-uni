import{d as e,r as a,y as l,e as n,f as t,w as s,g as o,s as u,A as i,i as r,j as c,F as d,n as v,ac as m,k as h,ah as g,h as f,t as p,D as y,ai as w}from"./index-ddWhPHnE.js";import{g as b}from"./page-wraper.DJ6J_9uw.js";import{b as k,d as _,c as x,m as C,n as K,e as $,F as I,f as S,G as E,H as P,E as V,i as j,_ as D}from"./wd-icon.CdzlT4Xd.js";function H(e,a,l){let n=$(e)?e:[e];const t=new Set(e.map(I));if(1!==t.size&&t.has("object"))throw Error("The columns are correct");$(e[0])||(n=[n]);return n.map((e=>e.map((e=>{if(!S(e))return{[a]:e,[l]:e};if(!e.hasOwnProperty(a)&&!e.hasOwnProperty(l))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(l)||(e[l]=e[a]),e.hasOwnProperty(a)||(e[a]=e[l]),e}))))}const O=D(e({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...k,loading:_(!1),loadingColor:x("#4D80F0"),columnsHeight:C(217),valueKey:x("value"),labelKey:x("label"),immediateChange:_(!1),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:K(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:k,emit:_}){const x=e,C=_,K=a([]),S=a(35),D=a([]);l([()=>x.modelValue,()=>x.columns],((e,a)=>{V(a[1],e[1])||($(e[1])&&e[1].length>0?K.value=H(e[1],x.valueKey,x.labelKey):(K.value=[],D.value=[])),j(e[0])&&function(e){if(0===K.value.length)return void(D.value=[]);(""===e||!j(e)||$(e)&&0===e.length)&&(e=K.value.map((e=>e[0][x.valueKey])));const a=I(e),l=["string","number","boolean","array"];-1===l.indexOf(a)&&console.error(`value must be one of ${l.toString()}`);e=(e=$(e)?e:[e]).slice(0,K.value.length);let n=E(D.value);e.forEach(((e,a)=>{let l=K.value[a].findIndex((a=>a[x.valueKey].toString()===e.toString()));l=-1===l?0:l,n=A(a,l,n)})),D.value=n.slice(0,e.length)}(e[0])}),{deep:!0,immediate:!0});const{proxy:O}=y();function A(e,a,l){const n=K.value[e];if(!n||!n[a])throw Error(`The value to select with Col:${e} Row:${a} is incorrect`);const t=E(l);if(t[e]=a,n[a].disabled){const l=n.slice(0,a).reverse().findIndex((e=>!e.disabled)),s=n.slice(a+1).findIndex((e=>!e.disabled));-1!==l?t[e]=a-1-l:-1!==s?t[e]=a+1+s:void 0===t[e]&&(t[e]=0)}return t}function F({detail:{value:e}}){const a=function(e){e=e.slice(0,K.value.length);const a=E(D.value);let l=E(D.value);e.forEach(((e,n)=>{(e=P(e,0,K.value[n].length-1))!==a[n]&&(l=A(n,e,l))}));const n=function(e,a){if(!e||!a)return-1;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(l,a);if(-1===n)return;const t=l[n];return 1===l.length?t:n}(e=e.map((e=>Number(e||0))));D.value=E(e),m((()=>{D.value=function(e){let a=E(e);return e.forEach(((e,l)=>{e=P(e,0,K.value[l].length-1),a=A(l,e,a)})),a}(e),x.columnChange?x.columnChange.length<4?(x.columnChange(O.$.exposed,G(),a||0,(()=>{})),T(a||0)):x.columnChange(O.$.exposed,G(),a||0,(()=>{T(a||0)})):T(a||0)}))}function T(e){const a=N();V(a,x.modelValue)||(C("update:modelValue",a),setTimeout((()=>{C("change",{picker:O.$.exposed,value:a,index:e})}),0))}function G(){const e=D.value.map(((e,a)=>K.value[a][e]));return 1===e.length?e[0]:e}function N(){const{valueKey:e}=x,a=D.value.map(((a,l)=>K.value[l][a][e]));return 1===a.length?a[0]:a}function q(){C("pickstart")}function z(){C("pickend")}return k({getSelects:G,getValues:N,setColumnData:function(e,a,l=0){K.value[e]=H(a,x.valueKey,x.labelKey).reduce(((e,a)=>e.concat(a)),[]),D.value=A(e,l,D.value)},getColumnsData:function(){return E(K.value)},getColumnData:function(e){return K.value[e]},getColumnIndex:function(e){return D.value[e]},getLabels:function(){const{labelKey:e}=x;return D.value.map(((a,l)=>K.value[l][a][e]))},getSelectedIndex:function(){return D.value},resetColumns:function(e){$(e)&&e.length&&(K.value=H(e,x.valueKey,x.labelKey))}}),(e,a)=>{const l=h,m=w,y=g;return n(),t(l,{class:v(`wd-picker-view ${e.customClass}`),style:i(e.customStyle)},{default:s((()=>[e.loading?(n(),t(l,{key:0,class:"wd-picker-view__loading"},{default:s((()=>[o(b,{color:e.loadingColor},null,8,["color"])])),_:1})):u("",!0),o(l,{style:i(`height: ${e.columnsHeight-20}px;`)},{default:s((()=>[o(y,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${S.value}px;`,style:i(`height: ${e.columnsHeight-20}px;`),value:D.value,"immediate-change":e.immediateChange,onChange:F,onPickstart:q,onPickend:z},{default:s((()=>[(n(!0),r(d,null,c(K.value,((a,o)=>(n(),t(m,{key:o,class:"wd-picker-view-column"},{default:s((()=>[(n(!0),r(d,null,c(a,((a,u)=>(n(),t(l,{key:u,class:v(`wd-picker-view-column__item ${a.disabled?"wd-picker-view-column__item--disabled":""}  ${D.value[o]==u?"wd-picker-view-column__item--active":""}`),style:i(`line-height: ${S.value}px;`)},{default:s((()=>[f(p(a[e.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value","immediate-change"])])),_:1},8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-d8f93211"]]);export{H as f,O as w};
