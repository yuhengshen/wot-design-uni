import{d as s,a0 as e,y as o,e as r,f as a,w as t,z as p,s as n,n as l,A as c,k as i}from"./index-ddWhPHnE.js";import{a as m,b as f}from"./page-wraper.DJ6J_9uw.js";import{e as d,i as u,B as g,s as h,u as y,G as w,_ as b}from"./wd-icon.CdzlT4Xd.js";import{u as j}from"./useChildren.8_evwfA-.js";import{f as k,F as v}from"./wd-cell.DKtYKzk0.js";const E=b(s({name:"wd-form",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:k,setup(s,{expose:b}){const{show:k}=m("wd-form-toast"),E=s,{children:x,linkChildren:C}=j(v);let O=e({});function _(s){s?O[s]="":Object.keys(O).forEach((s=>{O[s]=""}))}return C({props:E,errorMessages:O}),o((()=>E.model),(()=>{E.resetOnChange&&_()}),{immediate:!0,deep:!0}),b({validate:async function(s){const e=[];let o=!0;const r=[],a=function(){const s=w(E.rules),e=x.map((s=>s.prop));return Object.keys(s).forEach((o=>{e.includes(o)||delete s[o]})),x.forEach((e=>{u(e.prop)&&u(e.rules)&&e.rules.length&&(s[e.prop]?s[e.prop]=[...s[e.prop],...e.rules]:s[e.prop]=e.rules)})),s}(),t=d(s)?s:u(s)?[s]:[],p=t.length>0?t.reduce(((s,e)=>(a[e]&&(s[e]=a[e]),s)),{}):a;for(const n in p){const s=p[n],a=g(E.model,n);if(s&&s.length>0)for(const t of s){if(t.required&&(!u(a)||""===a)){e.push({prop:n,message:t.message}),o=!1;break}if(t.pattern&&!t.pattern.test(a)){e.push({prop:n,message:t.message}),o=!1;break}const{validator:s,...p}=t;if(s){const l=s(a,p);h(l)?r.push(l.then((s=>{"string"==typeof s?(e.push({prop:n,message:s}),o=!1):"boolean"!=typeof s||s||(e.push({prop:n,message:t.message}),o=!1)})).catch((s=>{const r=u(s)?y(s)?s:s.message||t.message:t.message;e.push({prop:n,message:r}),o=!1}))):l||(e.push({prop:n,message:t.message}),o=!1)}}}return await Promise.all(r),function(s){const e=x.map((s=>s.prop)).filter(Boolean),o=s.filter((s=>s.message&&e.includes(s.prop)));o.length&&(o.sort(((s,o)=>e.indexOf(s.prop)-e.indexOf(o.prop))),"toast"===E.errorType?k(o[0].message):"message"===E.errorType&&o.forEach((s=>{O[s.prop]=s.message})))}(e),o&&(t.length?t.forEach(_):_()),{valid:o,errors:e}},reset:function(){_()}}),(s,e)=>{const o=i;return r(),a(o,{class:l(`wd-form ${s.customClass}`),style:c(s.customStyle)},{default:t((()=>[p(s.$slots,"default",{},void 0,!0),"toast"===E.errorType?(r(),a(f,{key:0,selector:"wd-form-toast"})):n("",!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-977d4bc0"]]);export{E as _};
