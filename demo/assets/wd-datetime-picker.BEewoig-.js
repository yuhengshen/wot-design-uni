import{d as e,r as a,y as l,x as t,V as u,q as o,b as r,c as s,e as i,f as n,w as c,g as m,z as d,n as v,A as f,i as p,h as y,t as g,F as _,s as b,u as h,ac as k,k as w,l as C,D as V}from"./index-ddWhPHnE.js";import{b as x,d as $,c as F,m as S,l as T,n as D,e as P,G as H,i as M,w as j,O as L,E as z,r as K,_ as O}from"./wd-icon.CdzlT4Xd.js";import{e as q}from"./page-wraper.DJ6J_9uw.js";import{w as A,g as B}from"./wd-datetime-picker-view.CDIP2Yef.js";import{a as I,u as W,F as U}from"./wd-cell.DKtYKzk0.js";import{u as G}from"./useTranslate.D-OItNaP.js";import{d as N}from"./dayjs.CnZDUnXN.js";const R=O(e({name:"wd-datetime-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...x,label:String,placeholder:String,disabled:$(!1),readonly:$(!1),loading:$(!1),loadingColor:F("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:$(!1),size:String,labelWidth:F("33%"),useDefaultSlot:$(!1),useLabelSlot:$(!1),error:$(!1),alignRight:$(!1),closeOnClickModal:$(!0),safeAreaInsetBottom:$(!0),ellipsis:$(!1),columnsHeight:S(217),valueKey:F("value"),labelKey:F("label"),modelValue:T([String,Number,Array]),type:F("datetime"),minDate:S(new Date((new Date).getFullYear()-10,0,1).getTime()),maxDate:S(new Date((new Date).getFullYear()+10,11,31,23,59,59).getTime()),minHour:S(0),maxHour:S(23),minMinute:S(0),maxMinute:S(59),filter:Function,formatter:Function,displayFormat:Function,beforeConfirm:Function,displayFormatTabLabel:Function,defaultValue:[String,Number,Array],zIndex:S(15),prop:String,rules:D(),customCellClass:F(""),customViewClass:F(""),customLabelClass:F(""),customValueClass:F(""),immediateChange:$(!1)},emits:["change","open","toggle","cancel","confirm","update:modelValue"],setup(e,{expose:x,emit:$}){const F=e,S=$,{translate:T}=G("datetime-picker"),D=a(),O=a(),R=a(""),Y=a(!1),E=a(!0),J=a(!1),Q=a([]),X=a(""),Z=a(""),ee=a(!1),ae=a(!1),le=a(!1),{proxy:te}=V(),ue=I();l((()=>F.modelValue),((e,a)=>{z(e,a)||(P(e)?(J.value=!0,X.value=H(de(!0)),Z.value=H(de(!0,!0))):X.value=H(de()),k((()=>{Ce(!1,!1,!0)})))}),{deep:!0,immediate:!0}),l((()=>F.displayFormat),(e=>{e&&!K(e)&&console.error("The type of displayFormat must be Function")}),{deep:!0,immediate:!0}),l((()=>F.filter),(e=>{e&&!K(e)&&console.error("The type of filter must be Function")}),{deep:!0,immediate:!0}),l((()=>F.formatter),(e=>{e&&!K(e)&&console.error("The type of formatter must be Function")}),{deep:!0,immediate:!0}),l((()=>F.beforeConfirm),(e=>{e&&!K(e)&&console.error("The type of beforeConfirm must be Function")}),{deep:!0,immediate:!0}),l((()=>F.displayFormatTabLabel),(e=>{e&&!K(e)&&console.error("The type of displayFormatTabLabel must be Function")}),{deep:!0,immediate:!0}),l((()=>F.defaultValue),(e=>{P(e)||J.value?(X.value=H(de(!0)),Z.value=H(de(!0,!0))):X.value=H(de())}),{deep:!0,immediate:!0});const{parent:oe}=W(U),re=t((()=>oe&&F.prop&&oe.errorMessages&&oe.errorMessages[F.prop]?oe.errorMessages[F.prop]:"")),se=t((()=>{let e=!1;if(oe&&oe.props.rules){const a=oe.props.rules;for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&l===F.prop&&Array.isArray(a[l])&&(e=a[l].some((e=>e.required)))}return F.required||F.rules.some((e=>e.required))||e}));function ie(e,a,l,t,u){const{type:o}=F;switch(o){case"datetime":{const[o,r,s,i,n]=u;if("year"===a)return e?l>o:l<o;if("month"===a&&t[0]===o)return e?l>r:l<r;if("date"===a&&t[0]===o&&t[1]===r)return e?l>s:l<s;if("hour"===a&&t[0]===o&&t[1]===r&&t[2]===s)return e?l>i:l<i;if("minute"===a&&t[0]===o&&t[1]===r&&t[2]===s&&t[3]===i)return e?l>n:l<n;break}case"year-month":{const[o,r]=u;if("year"===a)return e?l>o:l<o;if("month"===a&&t[0]===o)return e?l>r:l<r;break}case"year":{const[t]=u;if("year"===a)return e?l>t:l<t;break}case"date":{const[o,r,s]=u;if("year"===a)return e?l>o:l<o;if("month"===a&&t[0]===o)return e?l>r:l<r;if("date"===a&&t[0]===o&&t[1]===r)return e?l>s:l<s;break}case"time":{const[o,r]=u;if("hour"===a)return e?l>o:l<o;if("minute"===a&&t[0]===o)return e?l>r:l<r;break}}return!1}const ne=e=>{if(!e)return[];const{type:a}=F,{startSymbol:l,formatter:t}=e,u=e.correctValue(X.value),o=e.correctValue(Z.value),r=l?e.getPickerValue(u,a):e.getPickerValue(o,a),s=l?e.getPickerValue(o,a):e.getPickerValue(u,a);return e.getOriginColumns().map(((e,a)=>e.values.map((a=>{const u=ie(l,e.type,a,r,s);return{label:t?t(e.type,L(a)):L(a),value:a,disabled:u}}))))};function ce(e){let a="before"===e?X.value:Z.value,l=[];return a&&(l=B(a,F.type)),l.map((e=>({[F.labelKey]:L(e),[F.valueKey]:e})))}function me(){}function de(e,a){const{modelValue:l,defaultValue:t,maxDate:u,minDate:o,type:r}=F;if(e){const e=a?1:0,s=P(l)?l[e]:"",i=P(t)?t[e]:"",n="time"===r?N(u).format("HH:mm"):u,c="time"===r?N(o).format("HH:mm"):o;return s||i||(a?n:c)}return M(l||t)?l||t:""}function ve(){F.disabled||F.readonly||(S("open"),J.value?(Y.value=!0,E.value=!0,X.value=H(de(!0,!1)),Z.value=H(de(!0,!0))):(Y.value=!0,X.value=H(de())),Ce(!0,!1,!0))}function fe(){E.value=!E.value;const e=E.value?D.value:O.value;e.setColumns(e.updateColumns()),S("toggle",E.value?X.value:Z.value)}function pe({value:e}){if(D.value&&(!J.value||O.value))if(J.value){const a=D.value.getPickerValue(e,F.type),l=D.value.getPickerValue(Z.value,F.type),t=D.value.getOriginColumns().some(((e,t)=>ie(!0,e.type,a[t],a,l)));X.value=H(t?Z.value:e),k((()=>{Q.value=[we(),H(Q.value[1])],S("change",{value:[X.value,Z.value]}),D.value&&D.value.setColumns(D.value.updateColumns()),O.value&&O.value.setColumns(O.value.updateColumns())}))}else X.value=H(e),S("change",{value:X.value})}function ye({value:e}){if(!D.value||!O.value)return;const a=O.value.getPickerValue(e,F.type),l=O.value.getPickerValue(X.value,F.type),t=O.value.getOriginColumns().some(((e,t)=>ie(!1,e.type,a[t],a,l)));Z.value=H(t?X.value:e),k((()=>{Q.value=[H(Q.value[0]),we(1)],S("change",{value:[X.value,Z.value]}),D.value&&D.value.setColumns(D.value.updateColumns()),O.value&&O.value.setColumns(O.value.updateColumns())}))}function ge(){Y.value=!1,setTimeout((()=>{J.value?(X.value=H(de(!0)),Z.value=H(de(!0,!0))):X.value=H(de())}),200),S("cancel")}function _e(){if(F.loading||le.value)return;if(ee.value)return void(ae.value=!0);const{beforeConfirm:e}=F;e?e(J.value?[X.value,Z.value]:X.value,(e=>{e&&ke()}),te.$.exposed):ke()}function be(){ee.value=!0}function he(){ee.value=!1,setTimeout((()=>{ae.value&&(ae.value=!1,_e())}),50)}function ke(){if(F.loading||le.value||F.disabled)return void(Y.value=!1);const e=J.value?[X.value,Z.value]:X.value;Y.value=!1,S("update:modelValue",e),S("confirm",{value:e}),Ce(!1,!0)}function we(e=0){if(J.value){let a=[];return a=0===e?(D.value?D.value.getSelects():void 0)||X.value&&ce("before"):(O.value?O.value.getSelects():void 0)||Z.value&&ce("after"),Ve(a,!0)}return""}function Ce(e=!1,a=!1,l=!1){if(J.value){const t=l?X.value&&ce("before")||[]:D.value&&D.value.getSelects&&D.value.getSelects()||[],u=l?Z.value&&ce("after")||[]:O.value&&O.value.getSelects&&O.value.getSelects()||[];R.value=e?R.value:[F.modelValue[0]||a?Ve(t):"",F.modelValue[1]||a?Ve(u):""],Q.value=[Ve(t,!0),Ve(u,!0)]}else{const e=l?X.value&&ce("before")||[]:D.value&&D.value.getSelects&&D.value.getSelects()||[];R.value=H(F.modelValue||a?Ve(e):"")}}function Ve(e,a=!1){if(0===e.length)return"";if(a&&F.displayFormatTabLabel)return F.displayFormatTabLabel(e);if(F.displayFormat)return F.displayFormat(e);if(F.formatter){const a={year:["year"],datetime:["year","month","date","hour","minute"],date:["year","month","date"],time:["hour","minute"],"year-month":["year","month"]};return e.map(((e,l)=>F.formatter(a[F.type][l],e.value))).join("")}switch(F.type){case"year":return e[0].label;case"date":return`${e[0].label}-${e[1].label}-${e[2].label}`;case"year-month":return`${e[0].label}-${e[1].label}`;case"time":return`${e[0].label}:${e[1].label}`;case"datetime":return`${e[0].label}-${e[1].label}-${e[2].label} ${e[3].label}:${e[4].label}`}}return u((()=>{const{modelValue:e}=F;P(e)?(J.value=!0,X.value=H(de(!0)),Z.value=H(de(!0,!0))):X.value=H(de())})),o((()=>{Ce(!1,!1,!0)})),x({open:function(){ve()},close:function(){ge()},setLoading:function(e){le.value=e}}),(e,a)=>{const l=w,t=C,u=r(s("wd-icon"),j);return i(),n(l,{class:v(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${h(ue).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:f(e.customStyle)},{default:c((()=>[m(l,{class:"wd-picker__field",onClick:ve},{default:c((()=>[e.$slots.default?d(e.$slots,"default",{key:0},void 0,!0):(i(),n(l,{key:1,class:v(["wd-picker__cell",e.customCellClass])},{default:c((()=>[e.label||e.$slots.label?(i(),n(l,{key:0,class:v(`wd-picker__label ${e.customLabelClass} ${se.value?"is-required":""}`),style:f(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:c((()=>[e.$slots.label?d(e.$slots,"label",{key:0},void 0,!0):(i(),p(_,{key:1},[y(g(e.label),1)],64))])),_:3},8,["class","style"])):b("",!0),m(l,{class:"wd-picker__body"},{default:c((()=>[m(l,{class:"wd-picker__value-wraper"},{default:c((()=>[m(l,{class:v(`wd-picker__value ${e.customValueClass}`)},{default:c((()=>[J.value?(i(),p(_,{key:0},[h(P)(R.value)?(i(),n(l,{key:0},{default:c((()=>[m(t,{class:v(R.value[0]?"":"wd-picker__placeholder")},{default:c((()=>[y(g(R.value[0]?R.value[0]:e.placeholder||h(T)("placeholder")),1)])),_:1},8,["class"]),y(" "+g(h(T)("to"))+" ",1),m(t,{class:v(R.value[1]?"":"wd-picker__placeholder")},{default:c((()=>[y(g(R.value[1]?R.value[1]:e.placeholder||h(T)("placeholder")),1)])),_:1},8,["class"])])),_:1})):(i(),n(l,{key:1,class:"wd-picker__placeholder"},{default:c((()=>[y(g(e.placeholder||h(T)("placeholder")),1)])),_:1}))],64)):(i(),n(l,{key:1,class:v(R.value?"":"wd-picker__placeholder")},{default:c((()=>[y(g(R.value?R.value:e.placeholder||h(T)("placeholder")),1)])),_:1},8,["class"]))])),_:1},8,["class"]),e.disabled||e.readonly?b("",!0):(i(),n(u,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),re.value?(i(),n(l,{key:0,class:"wd-picker__error-message"},{default:c((()=>[y(g(re.value),1)])),_:1})):b("",!0)])),_:1})])),_:3},8,["class"]))])),_:3}),m(q,{modelValue:Y.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Y.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"safe-area-inset-bottom":e.safeAreaInsetBottom,"z-index":e.zIndex,onClose:ge,"custom-class":"wd-picker__popup"},{default:c((()=>[m(l,{class:"wd-picker__wraper"},{default:c((()=>[m(l,{class:"wd-picker__toolbar",onTouchmove:me},{default:c((()=>[m(l,{class:"wd-picker__action wd-picker__action--cancel",onClick:ge},{default:c((()=>[y(g(e.cancelButtonText||h(T)("cancel")),1)])),_:1}),e.title?(i(),n(l,{key:0,class:"wd-picker__title"},{default:c((()=>[y(g(e.title),1)])),_:1})):b("",!0),m(l,{class:v("wd-picker__action "+(e.loading||le.value?"is-loading":"")),onClick:_e},{default:c((()=>[y(g(e.confirmButtonText||h(T)("confirm")),1)])),_:1},8,["class"])])),_:1}),J.value?(i(),n(l,{key:0,class:"wd-picker__region-tabs"},{default:c((()=>[m(l,{class:v(`wd-picker__region ${E.value?"is-active":""} `),onClick:fe},{default:c((()=>[m(l,null,{default:c((()=>[y(g(h(T)("start")),1)])),_:1}),m(l,{class:"wd-picker__region-time"},{default:c((()=>[y(g(Q.value[0]),1)])),_:1})])),_:1},8,["class"]),m(l,{class:v("wd-picker__region "+(E.value?"":"is-active")),onClick:fe},{default:c((()=>[m(l,null,{default:c((()=>[y(g(h(T)("end")),1)])),_:1}),m(l,{class:"wd-picker__region-time"},{default:c((()=>[y(g(Q.value[1]),1)])),_:1})])),_:1},8,["class"])])),_:1})):b("",!0),m(l,{class:v(E.value?"wd-picker__show":"wd-picker__hidden")},{default:c((()=>[m(A,{"custom-class":e.customViewClass,ref_key:"datetimePickerView",ref:D,type:e.type,modelValue:X.value,"onUpdate:modelValue":a[0]||(a[0]=e=>X.value=e),loading:e.loading||le.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":h(P)(e.modelValue)?ne:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!0,"immediate-change":e.immediateChange,onChange:pe,onPickstart:be,onPickend:he},null,8,["custom-class","type","modelValue","loading","loading-color","columns-height","value-key","label-key","formatter","filter","column-formatter","max-hour","min-hour","max-date","min-date","max-minute","min-minute","immediate-change"])])),_:1},8,["class"]),m(l,{class:v(E.value?"wd-picker__hidden":"wd-picker__show")},{default:c((()=>[m(A,{"custom-class":e.customViewClass,ref_key:"datetimePickerView1",ref:O,type:e.type,modelValue:Z.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Z.value=e),loading:e.loading||le.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,formatter:e.formatter,filter:e.filter,"column-formatter":h(P)(e.modelValue)?ne:void 0,"max-hour":e.maxHour,"min-hour":e.minHour,"max-date":e.maxDate,"min-date":e.minDate,"max-minute":e.maxMinute,"min-minute":e.minMinute,"start-symbol":!1,"immediate-change":e.immediateChange,onChange:ye,onPickstart:be,onPickend:he},null,8,["custom-class","type","modelValue","loading","loading-color","columns-height","value-key","label-key","formatter","filter","column-formatter","max-hour","min-hour","max-date","min-date","max-minute","min-minute","immediate-change"])])),_:1},8,["class"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","safe-area-inset-bottom","z-index"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-38101545"]]);export{R as _};
