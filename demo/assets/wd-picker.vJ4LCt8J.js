import{d as e,r as l,x as a,y as s,q as o,V as t,ac as u,e as n,f as r,w as i,g as c,z as d,n as m,A as p,i as v,h as f,t as g,F as y,s as _,u as h,C as b,k,D as w}from"./index-ddWhPHnE.js";import{b as C,c as V,d as S,m as x,n as $,G as F,e as K,i as I,F as T,I as z,w as j,r as q,_ as A}from"./wd-icon.CdzlT4Xd.js";import{e as B}from"./page-wraper.DJ6J_9uw.js";import{f as D,w as L}from"./wd-picker-view.CKp2k1BN.js";import{a as M,u as O,F as W}from"./wd-cell.DKtYKzk0.js";import{u as H}from"./useTranslate.D-OItNaP.js";const P=A(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...C,customLabelClass:V(""),customValueClass:V(""),customViewClass:V(""),label:String,placeholder:String,disabled:S(!1),readonly:S(!1),loading:S(!1),loadingColor:V("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:S(!1),size:String,labelWidth:String,useDefaultSlot:S(!1),useLabelSlot:S(!1),error:S(!1),alignRight:S(!1),beforeConfirm:Function,closeOnClickModal:S(!0),safeAreaInsetBottom:S(!0),ellipsis:S(!1),columnsHeight:x(217),valueKey:V("value"),labelKey:V("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:x(15),prop:String,rules:$(),immediateChange:S(!1),clearable:S(!1)},emits:["confirm","open","cancel","clear","update:modelValue"],setup(e,{expose:C,emit:V}){const{translate:S}=H("picker"),x=e,$=V,A=l(null),P=M(),G=l(!1),R=l(!1),U=l(""),E=l(""),N=l([]),X=l([]),J=l(!1),Q=l(!1),Y=a((()=>x.loading||G.value));s((()=>x.displayFormat),(e=>{e&&!q(e)&&console.error("The type of displayFormat must be Function"),A.value&&0!==A.value.getSelectedIndex().length&&se(x.modelValue)}),{immediate:!0,deep:!0}),s((()=>x.modelValue),(e=>{E.value=e,se(e)}),{deep:!0,immediate:!0}),s((()=>x.columns),(e=>{N.value=F(e),X.value=F(e),0===e.length?(E.value=K(x.modelValue)?[]:"",U.value=""):se(x.modelValue)}),{deep:!0,immediate:!0}),s((()=>x.columnChange),(e=>{e&&!q(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:Z}=O(W),ee=a((()=>Z&&x.prop&&Z.errorMessages&&Z.errorMessages[x.prop]?Z.errorMessages[x.prop]:"")),le=a((()=>{let e=!1;if(Z&&Z.props.rules){const l=Z.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===x.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return x.required||x.rules.some((e=>e.required))||e})),{proxy:ae}=w();function se(e){K(e)&&e.length>0||I(e)&&!K(e)&&""!==e?A.value?u((()=>{ie(A.value.getSelects())})):ie(function(e){const l=D(x.columns,x.valueKey,x.labelKey);if(0===x.columns.length)return;if(""===e||!I(e)||K(e)&&0===e.length)return;const a=T(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];e=K(e)?e:[e],e=e.slice(0,l.length),0===e.length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let o=l[a].findIndex((l=>l[x.valueKey].toString()===e.toString()));o=-1===o?0:o,s.push(o)}));const o=s.map(((e,a)=>l[a][e]));if(1===o.length)return o[0];return o}(e)):U.value=""}function oe(){x.disabled||x.readonly||($("open"),R.value=!0,E.value=x.modelValue,N.value=X.value)}function te(){R.value=!1,$("cancel");let e=setTimeout((()=>{clearTimeout(e),I(A.value)&&A.value.resetColumns(X.value)}),300)}function ue(){if(Y.value)return;if(J.value)return void(Q.value=!0);const{beforeConfirm:e}=x;e&&q(e)?e(E.value,(e=>{e&&ne()}),ae.$.exposed):ne()}function ne(){if(Y.value||x.disabled)return void(R.value=!1);const e=A.value.getSelects(),l=A.value.getValues(),a=A.value.getColumnsData();R.value=!1,X.value=F(a),$("update:modelValue",l),ie(e),$("confirm",{value:l,selectedItems:e})}function re({value:e}){E.value=e}function ie(e){if(K(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=x;U.value=(x.displayFormat||z)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){J.value=!0}function me(){J.value=!1,Q.value&&(Q.value=!1,ue())}o((()=>{se(x.modelValue)})),t((()=>{N.value=F(x.columns),X.value=F(x.columns)}));const pe=a((()=>x.clearable&&!x.disabled&&!x.readonly&&U.value.length));function ve(){const e=K(E.value)?[]:"";$("update:modelValue",e),$("clear")}const fe=a((()=>!x.disabled&&!x.readonly&&!pe.value));return C({close:function(){te()},open:function(){oe()},setLoading:function(e){G.value=e}}),(e,l)=>{const a=k;return n(),r(a,{class:m(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${h(P).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:p(e.customStyle)},{default:i((()=>[c(a,{class:"wd-picker__field",onClick:oe},{default:i((()=>[e.useDefaultSlot?d(e.$slots,"default",{key:0},void 0,!0):(n(),r(a,{key:1,class:"wd-picker__cell"},{default:i((()=>[e.label||e.useLabelSlot?(n(),r(a,{key:0,class:m(`wd-picker__label ${e.customLabelClass}  ${le.value?"is-required":""}`),style:p(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:i((()=>[e.label?(n(),v(y,{key:0},[f(g(e.label),1)],64)):d(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):_("",!0),c(a,{class:"wd-picker__body"},{default:i((()=>[c(a,{class:"wd-picker__value-wraper"},{default:i((()=>[c(a,{class:m(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${U.value?"":"wd-picker__placeholder"}`)},{default:i((()=>[f(g(U.value?U.value:e.placeholder||h(S)("placeholder")),1)])),_:1},8,["class"]),fe.value?(n(),r(j,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"})):pe.value?(n(),r(a,{key:1,onClick:b(ve,["stop"])},{default:i((()=>[c(j,{"custom-class":"wd-picker__clear",name:"error-fill"})])),_:1})):_("",!0)])),_:1}),ee.value?(n(),r(a,{key:0,class:"wd-picker__error-message"},{default:i((()=>[f(g(ee.value),1)])),_:1})):_("",!0)])),_:1})])),_:3}))])),_:3}),c(B,{modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wd-picker__popup"},{default:i((()=>[c(a,{class:"wd-picker__wraper"},{default:i((()=>[c(a,{class:"wd-picker__toolbar",onTouchmove:ce},{default:i((()=>[c(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:te},{default:i((()=>[f(g(e.cancelButtonText||h(S)("cancel")),1)])),_:1}),e.title?(n(),r(a,{key:0,class:"wd-picker__title"},{default:i((()=>[f(g(e.title),1)])),_:1})):_("",!0),c(a,{class:m("wd-picker__action "+(Y.value?"is-loading":"")),onClick:ue},{default:i((()=>[f(g(e.confirmButtonText||h(S)("done")),1)])),_:1},8,["class"])])),_:1}),c(L,{ref_key:"pickerViewWd",ref:A,"custom-class":e.customViewClass,modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),columns:N.value,loading:Y.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,"immediate-change":e.immediateChange,onChange:re,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","immediate-change","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-1af57746"]]);export{P as _};
